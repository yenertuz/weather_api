<!DOCTYPE html>
<html>
  <head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="A weather API that uses the AccuWeather REST API. Use this website to check the weather for your favorite places.">
	<meta name="author" content="Yener Tuz">
	<link rel="icon" href="https://img.icons8.com/dusk/64/000000/app-symbol.png" type="image/gif" sizes="16x16">
  <title>Weather API assignment - Yener Tuz</title>
  <style>
  body {
    font-family: Helvetica;
  }

  .day-name {
    background-color: darkcyan;
    color: white;
    padding-left: 15px;
    padding-top: 3px;
    padding-bottom: 3px;
    margin-bottom: 5px;
    font-weight: bold;
  }

  header#title * {
    display: inline-block;
  }

  header#title {
    display:block;
    width: 100%;
    text-align: center;
    font-size: 25px;
    color: rgb(132,133,136);
    margin-bottom: 10px;
  }

  .inner-container {
    display:grid;
    grid-template-columns: 40% 60%;
  }

  .inner-container img {
    grid-column-start: 1;
    grid-column-end: span 1;
  }

  .inner-container .text {
    grid-column-start: 2;
    grid-column-end: span 1;
  }

  .inner-container img {
    height: 100%;
    width: 100%;
  }

  main {
    display: flex;
    justify-content: space-between;
  }

  main section {
    width: 30%
  }

  </style>
  </head>
  <body>
	  <div id='root'>
      
      <!-- HEADER -->
      
<header id="title">
WEATHER FORECAST FOR
<div id="location">
<div id="city">SAN JOSE</div>, 
<div id="state">CA</div>
</div>
</header>


<main>
      <!-- DAY 1 -->

<section id="day-1-section">
<div class="day-name" id="day-1-day-name">Today:</div>
<div class="inner-container">
<img id="day-1-img" class="day-img" src="https://developer.accuweather.com/sites/default/files/01-s.png">
<div class="text">
<div id="day-1-summary" class="summary">Clear</div>
<div id="day-1-temperatures" class="temperatures">
<div id="day-1-high" class="high">90</div> /
<div id="day-1-low" class="low">70</div>
F
</div>
</div>
</div>
</section>

      <!-- DAY 2 -->
<section id="day-2-section">
<div class="day-name" id="day-2-day-name">Today:</div>
<div class="inner-container">
<img id="day-2-img" class="day-img" src="https://developer.accuweather.com/sites/default/files/01-s.png">
<div class="text">
<div id="day-2-summary" class="summary">Clear</div>
<div id="day-2-temperatures" class="temperatures">
<div id="day-2-high" class="high">90</div> /
<div id="day-2-low" class="low">70</div>
F
</div></div></div>
</section>
      <!-- DAY 3 -->
<section id="day-3-section">
<div class="day-name" id="day-3-day-name">Today:</div>
<div class="inner-container">
<img id="day-3-img" class="day-img" src="https://developer.accuweather.com/sites/default/files/01-s.png">
<div class="text">
<div id="day-3-summary" class="summary">Clear</div>
<div id="day-3-temperatures" class="temperatures">
<div id="day-3-high" class="high">90</div> /
<div id="day-3-low" class="low">70</div>
F
</div></div></div>
</section>

</main>

    </div>
  </body>
  <script>

// personal api key = Ul1GdOP7L4e7JoZjPCEfGD6B3BwWFJKF

// api key from movable = wJzJStEhgnn6wSVdxvK56XpvFE4sYeoC

  function display_state(state) {
    document.getElementById("root").innerHTML = JSON.stringify(state.days);
  }

  function get_index_for_relevant_days(state) {
    state.index = -1;
    state.days_response["DailyForecasts"].forEach(
      (element, index) => {
        let date_string = element["Date"].substring(0, 10);
        if (date_string == state.today_date) {
          state.index = index;
        }
      }
    );
  }

  function fetch_days(state) {
    state.days = state.days_response["DailyForecasts"].slice(state.index, state.index + 3);
  }

  function get_relevant_days(state) {
    let today_date_object = new Date(state.date);
    let today_date_string = today_date_object.toISOString();
    today_date_string = today_date_string.substring(0, 10);
    state.today_date = today_date_string;
    console.log(today_date_string);
    get_index_for_relevant_days(state);
    if (state.index == -1) {
      return ;
    }
    fetch_days(state);
  }

  function get_query_parameters(state) {
    let url_params = new URLSearchParams(window.location.search);
    let zip_code = url_params.get("zip_code");
    let date = url_params.get("date");
    state.zip_code = zip_code;
    state.date = date;
  }

  function fetch_weather_information(state) {
    let url = "http://dataservice.accuweather.com/forecasts/v1/daily/5day/";
    url += state.location_key;
    url += "?apikey=" + state.api_key;
    let ajax_request = new XMLHttpRequest();
    ajax_request.onreadystatechange = function() {
      if (this.readyState != 4 || this.status != 200) {
        return ;
      }
      let response_object = JSON.parse(this.responseText);
      state.days_response = response_object;
      get_relevant_days(state);
      display_state(state);
    }
    ajax_request.open("GET", url, true);
    ajax_request.send();
  }

  function fetch_location_key(state) {
    let url = "http://dataservice.accuweather.com/locations/v1/postalcodes/us/search?";
    url += "q=" + encodeURIComponent(state.zip_code);
    url += "&apikey=" + encodeURIComponent(state.api_key);
    let ajax_request = new XMLHttpRequest();
    ajax_request.onreadystatechange = function() {
      if (this.readyState != 4 || this.status != 200) {
        return ;
      }
      let response_object = JSON.parse(this.responseText);
      state.location_key = response_object[0]["Key"];
      state.city = response_object[0]["EnglishName"];
      state.state = response_object[0]["AdministrativeArea"]["ID"];
      state.key_response = response_object;
      fetch_weather_information(state);
    }
    ajax_request.open("GET", url, true);
    ajax_request.send();
  }

  function main() {
      let state = {};
      window.state = state;
      state.api_key = "Ul1GdOP7L4e7JoZjPCEfGD6B3BwWFJKF";
      get_query_parameters(state);
      fetch_location_key(state);
      return ;
      fetch_weather_information(state);
      render_weather_information(state);
  }
  
  // main();
  
  </script> 
</html>
